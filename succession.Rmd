---
title: "President of the LDS Church Succession"
output:
  html_document:
    df_print: paged
---

This analysis addresses succession in the presidency of the LDS Church. See Github for <a href="https://github.com/nwstephens/lds" target="_blank">N.W. Stephes' code</a>. See <a href="http://zelophehadsdaughters.com/2018/01/04/church-president-probability-changes-with-president-monsons-death/#more-12559" target="_blank">here</a> for a similiar analysis. This is an updated and enhanced version of Stephens' code.

## Setup

```{r, message=FALSE}
library(dplyr)
library(ggplot2)
library(readr)
library(tibble)
library(purrr)
library(rvest)
library(reshape2)
library(ggrepel)
```

## Data

#### Current members

Current members of the <a href="https://en.wikipedia.org/wiki/List_of_general_authorities_of_The_Church_of_Jesus_Christ_of_Latter-day_Saints#Quorum_of_the_Twelve_Apostles" target="_blank">Quorum of the Twelve</a>.

```{r}
rawdat <- matrix(
  nrow = 15, 
  byrow = TRUE, 
  dimnames = list(1:15, c("rnk", "name", "dob", "dos")), 
  data=c(
   "1",    "Russell M. Nelson",          "1924-09-09",    "1984-04-12",
   "2",    "Dallin H. Oaks",             "1932-08-12",    "1984-05-03",
   "3",    "Jeffrey R. Holland",         "1940-12-03",    "1994-06-23",
   "4",    "Henry B. Eyring",            "1933-05-31",    "1995-04-06",
   "5",    "Dieter F. Uchtdorf",         "1940-11-06",    "2004-10-07",
   "6",    "David A. Bednar",            "1952-06-15",    "2004-10-07",
   "7",    "Quentin L. Cook",            "1940-09-08",    "2007-10-11",
   "8",    "D. Todd Christofferson",     "1945-01-24",    "2008-04-10",
   "9",    "Neil L. Andersen",           "1951-08-09",    "2009-04-09",
  "10",    "Ronald A. Rasband",          "1951-02-06",    "2015-10-08",
  "11",    "Gary E. Stevenson",          "1955-08-06",    "2015-10-08",
  "12",    "Dale G. Renlund",            "1952-11-13",    "2015-10-08",
  "13",    "Gerrit W. Gong",             "1953-12-23",    "2018-03-31",
  "14",    "Ulisses Soares",             "1958-10-02",    "2018-03-31",
  "15",    "Patrick Kearon",             "1961-07-18",    "2023-12-07"  # new update since last version (2021)
 )
)
```

#### Organize data

Format dates and create current age based on today's date.

```{r}
today <- as.Date(format(Sys.Date(), format="%Y-%m-%d"))
dat <- as_tibble(rawdat) %>%
  mutate(dob = as.Date(dob)) %>%
  mutate(dos = as.Date(dos)) %>%
  mutate(age = today - dob)
```

#### Import life table

There are many life tables to chose from, and preliminary analysis shows that the predicted probabilities are highly sensitive depending on which table is chosen. This table is taken from the Social Security administration.

```{r}
# Try to read from web, fall back to static data if it fails
lifetable <- tryCatch({
  read_html("https://www.ssa.gov/oact/STATS/table4c6.html") %>%
    html_nodes(xpath="//td[(((count(preceding-sibling::*) + 1) = 2) and parent::*)]") %>%
    html_text %>%
    as.numeric %>%
    data.frame(age = 0:119, pdeath = .)
}, error = function(e) {
  # Fallback: 2021 SSA Life Table data for males
  male_pdeath <- c(
    0.005860, 0.000420, 0.000272, 0.000225, 0.000184, 0.000157, 0.000140, 0.000128, 0.000122, 0.000123,
    0.000129, 0.000138, 0.000164, 0.000220, 0.000310, 0.000446, 0.000637, 0.000868, 0.001100, 0.001270,
    0.001373, 0.001488, 0.001605, 0.001714, 0.001835, 0.001963, 0.002082, 0.002202, 0.002330, 0.002457,
    0.002574, 0.002683, 0.002787, 0.002881, 0.002974, 0.003074, 0.003175, 0.003295, 0.003444, 0.003608,
    0.003780, 0.003958, 0.004144, 0.004337, 0.004540, 0.004774, 0.005064, 0.005399, 0.005796, 0.006214,
    0.006671, 0.007167, 0.007736, 0.008351, 0.009035, 0.009770, 0.010567, 0.011398, 0.012291, 0.013224,
    0.014267, 0.015353, 0.016484, 0.017617, 0.018759, 0.019914, 0.021104, 0.022423, 0.023847, 0.025357,
    0.027050, 0.028970, 0.031188, 0.033754, 0.036747, 0.040563, 0.044308, 0.048498, 0.053229, 0.058778,
    0.064617, 0.070947, 0.077834, 0.085686, 0.094809, 0.105090, 0.116592, 0.129306, 0.142732, 0.157638,
    0.174458, 0.193027, 0.212930, 0.232657, 0.251826, 0.270943, 0.289756, 0.307998, 0.325393, 0.341662,
    0.358746, 0.376683, 0.395517, 0.415293, 0.436058, 0.457860, 0.480753, 0.504791, 0.530031, 0.556532,
    0.584359, 0.613577, 0.644256, 0.676468, 0.710292, 0.745806, 0.783097, 0.822251, 0.863364, 0.906532
  )
  
  data.frame(age = 0:119, pdeath = male_pdeath)
})
```

## Predictions

Solve the question: What is the probability of becoming president for each member of the quorum based solely on average time until death.

#### Inputs

```{r}
# Simulation inputs
N <- 20000
years <- 45

# Data inputs
age <- floor(dat$age/365)
nams <- dat$name
pvec <- lifetable$pdeath
```

#### Simulation

`pmat` is a $15 \times Y$ (apostles by `years`) array storing the SSA life table values. `out` is a $Y \times N$ array recording the name of the apostle who is President in year $y$.

```{r}
# Probabilities over time
pmat <- outer(age, 1:years, function(x, y) pvec[x + y])
pmat[is.na(pmat)] <- 0
pmat[, 1] <- 0 # assumes no one dies in the first year

# Simulate
out <- matrix("", years, N)
for(i in 1:N){
  alive <- apply(pmat, 1, function(x) !cumsum(rbinom(years, 1, x)))
  pres <- apply(cbind(alive, TRUE), 1, which.max)
  out[, i] <- c(nams, "none")[pres]
}
```

#### Average predicted probabilities

`pct` is a 15-length vector recording the fraction of simulations in which each apostle became President.

```{r}
pct <- map(nams, function(x) apply(out == x, 2, any)) %>%
  map_dbl(mean) * 100
```

#### Average tenure

`tenure` is an $N \times A$ (no. of simulations by number of apostles who ever become President) array where each element is the tenure length of the apostle who is 
President in that simulation.

`avg_tenure` is a named vector of $\leq 15$ elements where each element is the average tenure for that apostle across all simulations where they became president.

```{r}
tenure <- unlist(apply(out, 2, table))
avg_tenure <- unlist(tapply(tenure, names(tenure), mean))
```

## Summary

### Table

```{r}
dat2 <- dat %>%
  mutate(pct = pct) %>%
  mutate(tenure = round(as.numeric(avg_tenure[nams]), 2))
dat2
```

#### Visualize probability of ever becoming president

```{r}
ggplot(dat2, aes(reorder(nams, 15:1), pct)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  theme_minimal() +
  coord_flip() +
  labs(x = "", y = "Percent", title = "Likelihood of becoming president")
ggsave("pred_prob.png")
```

#### Visualize year-by-year probability of becoming president
```{r}
# Get current year and create year labels
current_year <- as.numeric(format(Sys.Date(), "%Y"))
calendar_years <- current_year:(current_year + years - 1)

# Year-by-year probabilities for each apostle
year_probs <- array(0, dim = c(years, length(nams)), 
                   dimnames = list(calendar_years, nams))

for(i in 1:length(nams)) {
  for(j in 1:years) {
    year_probs[j, i] <- mean(out[j, ] == nams[i]) * 100
  }
}

# Convert to data frame
year_probs_df <- as.data.frame(year_probs)
year_probs_df$year <- calendar_years
```

#### Visualize year-by-year probability of becoming president
```{r}
year_probs_long <- melt(year_probs_df, id.vars = "year", 
                       variable.name = "apostle", value.name = "probability")

# Get apex (maximum probability) for each apostle
apex_points <- year_probs_long %>%
  group_by(apostle) %>%
  filter(probability == max(probability)) %>%
  slice_head(n = 1) %>%  # In case of ties, take first
  mutate(last_name = sub(".*\\s", "", apostle))

ggplot(year_probs_long, aes(x = year, y = probability, color = apostle)) +
  geom_line() +
  geom_text_repel(data = apex_points, 
                  aes(label = last_name), 
                  show.legend = FALSE) +
  labs(title = "Year-by-year presidency probabilities", 
       x = "Calendar Year", y = "Probability (%)") +
  theme_minimal() +
  theme(legend.position = "none")
ggsave("pred_prob_by_year.png")
```
